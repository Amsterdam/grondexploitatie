import time

from jwcrypto.jwt import JWT
from authorization_django.jwks import get_keyset


def make_grex_token():
    jwks = get_keyset()
    assert len(jwks['keys']) > 0

    key = next(iter(jwks['keys']))
    now = int(time.time())

    header = {
        'alg': 'ES256',  # algorithm of the test key
        'kid': key.key_id
    }

    token = JWT(
        header=header,
        claims={
            'iat': now,
            'exp': now + 600,
            'scopes': ['GREX/R']
        }
    )
    token.make_signed_token(key)
    return token.serialize()


if __name__ == "__main__":
    print(make_grex_token())

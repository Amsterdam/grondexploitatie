alter table planex add column plannr integer;
update planex set plannr = cast((regexp_match("project_code", '^(\d{5})$'))[1] as integer);
create index plannr_idx on planex(plannr);
alter table planex rename column prijspeildatum to prijspeildatum_old;
alter table planex add column prijspeildatum date;
update planex set prijspeildatum = to_date(prijspeildatum_old, 'DD-MM-YY');
alter table grex_grenzen alter column plannr type integer;
-- In the new version start_datum is  already a date type
-- alter table grex_grenzen rename column startdatum to startdatum_old;
-- alter table grex_grenzen add column startdatum date;
-- update grex_grenzen set startdatum = to_date(replace(startdatum_old, '/', ''), 'YYYYMMDD') where startdatum_old is not null and startdatum_old <> '';
SELECT UpdateGeometrySRID('grex_grenzen', 'wkb_geometry', 28992);
DELETE FROM mapping_rapportage WHERE rapportagepost IS NULL;
-- If a geometry is invalid, try to make it valid and extract only polygons
UPDATE grex_grenzen
SET wkb_geometry = ST_CollectionExtract(ST_Makevalid(wkb_geometry), 3)
WHERE ST_IsValid(wkb_geometry) = False;

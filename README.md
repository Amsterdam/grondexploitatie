# Grondexploitatie

API and import module

## development

* python 3.6 (required)
* virtualenv (recommended)
* docker-compose (recommended)


    virtualenv --python=`which python3` --prompt='GR->' venv
    source venv/bin/activate

### installation

install required modules

    cd src
    pip install -r requirements.txt
    cd ..

and possibly

    pip install git+https://github.com/amsterdam/objectstore.git
    

### start database

    docker-compose up database
    
### configure objectstore access

    export GRONDEXPLOITATIE_OBJECTSTORE_PASSWORD=<secret_password>
    
### import data

    cd src/import
    sh import.sh local
    cd ../..

The following files are retrieved from Objectstore:

* Mappingbestand rapportage baten.xlsx (eenmalig)
* dump-panos-4-12-2017.xlsx (1 x 3 mnd)
* grex_grenzen.tgz (1 x jaar)

The following processing steps are executed:
* MapInfo files are converted to PostGIS SQL dump files    
* SQL files are converted to utf-8 encoded SQL files
* GREX grenzen are imported in the database
* Excel data is imported in the database
* Some data problems are fixed  

### Generate Django models
Optional step    
 
    python manage.py inspectdb > grondexploitatie/models.py
    
### Run server 
 
    cd src
    python manage.py runserver
    
Then test  URLS like :
 
    http://localhost:8000/projects/
    http://localhost:8000/project/26015/?use_period_groups 
    http://localhost:8000/project/26015/?use_period_groups&start_jaar=2018  
    
 